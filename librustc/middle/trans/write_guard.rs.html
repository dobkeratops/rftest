<head><link href="../../../css/shCore.css" rel="stylesheet" type="text/css"/><link href="../../../css/shThemeDefault.css" rel="stylesheet" type="text/css"/><link href="../../../css/sourcestyle.css" rel="stylesheet" type="text/css"/></head><body><div><maintext><div><fileblock><br/>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./../../../index.html">(index&lt;-&nbsp;)</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./../../../">&nbsp;&nbsp;&nbsp;&nbsp;./</a><c0><a href="./../../../librustc/">librustc</a></c0><c1>/</c1><c0><a href="./../../../librustc/middle/">middle</a></c0><c1>/</c1><c0><a href="./../../../librustc/middle/trans/">trans</a></c0><c1>/</c1><c0><a href="./../../../librustc/middle/trans/write_guard.rs.html">write_guard.rs</a></c0><br/><br/></fileblock></div><ln>&nbsp;&nbsp;1</ln><a id="1">&nbsp;</a>&nbsp;<c40>//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Rust&nbsp;Project&nbsp;Developers.&nbsp;See&nbsp;the&nbsp;COPYRIGHT
</c40><br/><ln>&nbsp;&nbsp;2</ln><a id="2">&nbsp;</a>&nbsp;<c40>//&nbsp;file&nbsp;at&nbsp;the&nbsp;top-level&nbsp;directory&nbsp;of&nbsp;this&nbsp;distribution&nbsp;and&nbsp;at
</c40><br/><ln>&nbsp;&nbsp;3</ln><a id="3">&nbsp;</a>&nbsp;<c40>//&nbsp;http://rust-lang.org/COPYRIGHT.
</c40><br/><ln>&nbsp;&nbsp;4</ln><a id="4">&nbsp;</a>&nbsp;<c40>//
</c40><br/><ln>&nbsp;&nbsp;5</ln><a id="5">&nbsp;</a>&nbsp;<c40>//&nbsp;Licensed&nbsp;under&nbsp;the&nbsp;Apache&nbsp;License,&nbsp;Version&nbsp;2.0&nbsp;&lt;LICENSE-APACHE&nbsp;or
</c40><br/><ln>&nbsp;&nbsp;6</ln><a id="6">&nbsp;</a>&nbsp;<c40>//&nbsp;http://www.apache.org/licenses/LICENSE-2.0&gt;&nbsp;or&nbsp;the&nbsp;MIT&nbsp;license
</c40><br/><ln>&nbsp;&nbsp;7</ln><a id="7">&nbsp;</a>&nbsp;<c40>//&nbsp;&lt;LICENSE-MIT&nbsp;or&nbsp;http://opensource.org/licenses/MIT&gt;,&nbsp;at&nbsp;your
</c40><br/><ln>&nbsp;&nbsp;8</ln><a id="8">&nbsp;</a>&nbsp;<c40>//&nbsp;option.&nbsp;This&nbsp;file&nbsp;may&nbsp;not&nbsp;be&nbsp;copied,&nbsp;modified,&nbsp;or&nbsp;distributed
</c40><br/><ln>&nbsp;&nbsp;9</ln><a id="9">&nbsp;</a>&nbsp;<c40>//&nbsp;except&nbsp;according&nbsp;to&nbsp;those&nbsp;terms.
</c40><br/><ln>&nbsp;10</ln><a id="10">&nbsp;</a>&nbsp;<c0>
</c0><br/><ln>&nbsp;11</ln><a id="11">&nbsp;</a>&nbsp;<c40>//!&nbsp;Logic&nbsp;relating&nbsp;to&nbsp;rooting&nbsp;and&nbsp;write&nbsp;guards&nbsp;for&nbsp;managed&nbsp;values.
</c40><br/><ln>&nbsp;12</ln><a id="12">&nbsp;</a>&nbsp;<c40>//!&nbsp;This&nbsp;code&nbsp;is&nbsp;primarily&nbsp;for&nbsp;use&nbsp;by&nbsp;datum;
</c40><br/><ln>&nbsp;13</ln><a id="13">&nbsp;</a>&nbsp;<c40>//!&nbsp;it&nbsp;exists&nbsp;in&nbsp;its&nbsp;own&nbsp;module&nbsp;both&nbsp;to&nbsp;keep&nbsp;datum.rs&nbsp;bite-sized
</c40><br/><ln>&nbsp;14</ln><a id="14">&nbsp;</a>&nbsp;<c40>//!&nbsp;and&nbsp;for&nbsp;each&nbsp;in&nbsp;debugging&nbsp;(e.g.,&nbsp;so&nbsp;you&nbsp;can&nbsp;use
</c40><br/><ln>&nbsp;15</ln><a id="15">&nbsp;</a>&nbsp;<c40>//!&nbsp;`RUST_LOG=rustc::middle::trans::write_guard`).
</c40><br/><ln>&nbsp;16</ln><a id="16">&nbsp;</a>&nbsp;<c0>
</c0><br/><ln>&nbsp;17</ln><a id="17">&nbsp;</a>&nbsp;<c0>
</c0><br/><ln>&nbsp;18</ln><a id="18">&nbsp;</a>&nbsp;<c21>use</c21><c0>&nbsp;middle::borrowck::</c0><c3>{</c3><c0>RootInfo</c0><c3>,</c3><c0>&nbsp;root_map_key</c0><c3>};</c3><c0>
</c0><br/><ln>&nbsp;19</ln><a id="19">&nbsp;</a>&nbsp;<c21>use</c21><c0>&nbsp;middle::trans::cleanup</c0><c3>;</c3><c0>
</c0><br/><ln>&nbsp;20</ln><a id="20">&nbsp;</a>&nbsp;<c21>use</c21><c0>&nbsp;middle::trans::common::*</c0><c3>;</c3><c0>
</c0><br/><ln>&nbsp;21</ln><a id="21">&nbsp;</a>&nbsp;<c21>use</c21><c0>&nbsp;middle::trans::datum::*</c0><c3>;</c3><c0>
</c0><br/><ln>&nbsp;22</ln><a id="22">&nbsp;</a>&nbsp;<c21>use</c21><c0>&nbsp;syntax::codemap::Span</c0><c3>;</c3><c0>
</c0><br/><ln>&nbsp;23</ln><a id="23">&nbsp;</a>&nbsp;<c21>use</c21><c0>&nbsp;syntax::ast</c0><c3>;</c3><c0>
</c0><br/><ln>&nbsp;24</ln><a id="24">&nbsp;</a><a id="n10669">&nbsp;</a><c0>
</c0><br/><ln>&nbsp;25</ln><a id="25">&nbsp;</a><a id="n10672"><a id="n10702"><a id="n10675"><a id="n10674"><a id="n10676">&nbsp;</a></a></a></a></a><c21>pub</c21><c1><a href="#24_1_refs">&nbsp;</a></c1><c30>fn</c30><c30><a href="#24_1_refs">&nbsp;root_and_write_guard</a></c30><c5><a href="#24_1_refs">&lt;'a</a></c5><c5>,</c5><c5><a href="#24_1_refs">&nbsp;K:</a></c5><c5><a href="../../../librustc/middle/trans/datum.rs.html#193">KindOps</a></c5><c5><a href="#24_1_refs">&gt;</a></c5><c4>(</c4><c20><a href="#25_43_refs">datum</a></c20><c1><a href="#24_1_refs">:&nbsp;</a></c1><c8><a href="#24_1_refs">&amp;</a></c8><c8><a href="../../../librustc/middle/trans/datum.rs.html#40">Datum&lt;</a></c8><c8><a href="c=0 n=10701">K</a></c8><c8><a href="../../../librustc/middle/trans/datum.rs.html#40">&gt;</a></c8><c3>,</c3><c1><a href="#24_1_refs">
</a></c1><br/><ln>&nbsp;26</ln><a id="26">&nbsp;</a><a id="n10681"><a id="n10682"><a id="n10683">&nbsp;</a></a></a><c1><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#26_43_refs">bcx</a></c20><c1><a href="#24_1_refs">:&nbsp;</a></c1><c8><a href="#24_1_refs">&amp;'a&nbsp;</a></c8><c8><a href="../../../librustc/middle/trans/common.rs.html#401">Block&lt;'a&gt;</a></c8><c3>,</c3><c1><a href="#24_1_refs">
</a></c1><br/><ln>&nbsp;27</ln><a id="27">&nbsp;</a><a id="n10686"><a id="n10687">&nbsp;</a></a><c1><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#27_43_refs">span</a></c20><c1><a href="#24_1_refs">:&nbsp;</a></c1><c8><a href="../../../libsyntax/codemap.rs.html#n10620">Span</a></c8><c3>,</c3><c1><a href="#24_1_refs">
</a></c1><br/><ln>&nbsp;28</ln><a id="28">&nbsp;</a><a id="n10691"><a id="n10690">&nbsp;</a></a><c1><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#28_43_refs">expr_id</a></c20><c1><a href="#24_1_refs">:&nbsp;</a></c1><c8><a href="../../../libsyntax/ast.rs.html#n18432">ast::NodeId</a></c8><c3>,</c3><c1><a href="#24_1_refs">
</a></c1><br/><ln>&nbsp;29</ln><a id="29">&nbsp;</a><a id="n10694"><a id="n10695"><a id="n10700"><a id="n10699"><a id="n10821">&nbsp;</a></a></a></a></a><c1><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#29_43_refs">derefs</a></c20><c1><a href="#24_1_refs">:&nbsp;</a></c1><c8><a href="#24_1_refs">uint</a></c8><c4>)</c4><c1><a href="#24_1_refs">&nbsp;</a></c1><c4>-&gt;</c4><c1><a href="#24_1_refs">&nbsp;</a></c1><c8><a href="#24_1_refs">&amp;'a&nbsp;</a></c8><c8><a href="../../../librustc/middle/trans/common.rs.html#401">Block&lt;'a&gt;</a></c8><c1><a href="#24_1_refs">&nbsp;</a></c1><c3>{</c3><c22><a href="#24_1_refs">
</a></c22><br/><ln>&nbsp;30</ln><a id="30">&nbsp;</a><a id="n10707"><a id="n10705"><a id="n10710"><a id="n10708"><a id="n10706"><a id="n10704"><a id="n10709">&nbsp;</a></a></a></a></a></a></a><c22><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c21>let</c21><c22><a href="#24_1_refs">&nbsp;</a></c22><c20><a href="#30_8_refs">key</a></c20><c16><a href="#24_1_refs">&nbsp;=&nbsp;</a></c16><c1><a href="../../../librustc/middle/borrowck/mod.rs.html#208">root_map_key&nbsp;</a></c1><c3>{</c3><c1><a href="../../../librustc/middle/borrowck/mod.rs.html#208">&nbsp;id:&nbsp;</a></c1><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#28">expr_id</a></c26><c3>,</c3><c1><a href="../../../librustc/middle/borrowck/mod.rs.html#208">&nbsp;derefs:&nbsp;</a></c1><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#29">derefs</a></c26><c1><a href="../../../librustc/middle/borrowck/mod.rs.html#208">&nbsp;</a></c1><c3>};</c3><c22><a href="#24_1_refs">
</a></c22><br/><ln>&nbsp;31</ln><a id="31">&nbsp;</a><a id="n10761"><a id="n10785"><a id="n10769"><a id="n10757"><a id="n10783"><a id="n10759"><a id="n10747"><a id="n10774"><a id="n10770"><a id="n10779"><a id="n10789"><a id="n10786"><a id="n10743"><a id="n10773"><a id="n10756"><a id="n10748"><a id="n10784"><a id="n10771"><a id="n10751"><a id="n10762"><a id="n10753"><a id="n10746"><a id="n10772"><a id="n10767"><a id="n10775"><a id="n10755"><a id="n10777"><a id="n10760"><a id="n10744"><a id="n10758"><a id="n10781"><a id="n10806"><a id="n10776"><a id="n10754"><a id="n10792"><a id="n10745"><a id="n10788"><a id="n10752"><a id="n10768"><a id="n10787"><a id="n10764"><a id="n10790"><a id="n10809"><a id="n10765"><a id="n10780"><a id="n10782"><a id="n10763"><a id="n10778"><a id="n10791"><a id="n10793"><a id="n10766">&nbsp;</a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a><c22><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;debug!</a></c22><c4>(</c4><c1><a href="../../../libstd/fmt/rt.rs.html#n169463">"write_guard::root_and_write_guard</a></c1><c4>(</c4><c1><a href="../../../libstd/fmt/rt.rs.html#n169463">key=</a></c1><c3>{</c3><c1><a href="../../../libstd/fmt/rt.rs.html#n169463">:?</a></c1><c3>}</c3><c4>)</c4><c1><a href="../../../libstd/fmt/rt.rs.html#n169463">"</a></c1><c3>,</c3><c22><a href="#24_1_refs">&nbsp;</a></c22><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#31">key</a></c26><c4>)</c4><c3>;</c3><c22><a href="#24_1_refs">
</a></c22><br/><ln>&nbsp;32</ln><a id="32">&nbsp;</a>&nbsp;<c22><a href="#24_1_refs">
</a></c22><br/><ln>&nbsp;33</ln><a id="33">&nbsp;</a>&nbsp;<c22><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//&nbsp;root&nbsp;the&nbsp;autoderef'd&nbsp;value,&nbsp;if&nbsp;necessary:
</c40><br/><ln>&nbsp;34</ln><a id="34">&nbsp;</a>&nbsp;<c22><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//
</c40><br/><ln>&nbsp;35</ln><a id="35">&nbsp;</a>&nbsp;<c22><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//&nbsp;(Note:&nbsp;root'd&nbsp;values&nbsp;are&nbsp;always&nbsp;boxes)
</c40><br/><ln>&nbsp;36</ln><a id="36">&nbsp;</a><a id="n10817"><a id="n10815"><a id="n10820"><a id="n10818"><a id="n10819"><a id="n10816">&nbsp;</a></a></a></a></a></a><c22><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c21>let</c21><c22><a href="#24_1_refs">&nbsp;</a></c22><c20><a href="#36_8_refs">ccx</a></c20><c13><a href="#24_1_refs">&nbsp;=&nbsp;</a></c13><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#26">bcx</a></c26><c10><a href="../../../librustc/middle/trans/common.rs.html#441">.ccx</a></c10><c4>()</c4><c3>;</c3><c22><a href="#24_1_refs">
</a></c22><br/><ln>&nbsp;37</ln><a id="37">&nbsp;</a><a id="n10825"><a id="n10822"><a id="n10826"><a id="n10827"><a id="n10824"><a id="n10823"><a id="n10828"><a id="n10841">&nbsp;</a></a></a></a></a></a></a></a><c22><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c21>match</c21><c21><a href="#24_1_refs">&nbsp;</a></c21><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#36">ccx</a></c26><c24><a href="../../../librustc/middle/trans/context.rs.html#102">.maps</a></c24><c24><a href="../../../librustc/middle/astencode.rs.html#53">.root_map</a></c24><c10><a href="../../../libstd/cell.rs.html#n107602">.borrow</a></c10><c4>()</c4><c10><a href="../../../libcollections/hashmap.rs.html#n13549">.find</a></c10><c4>(</c4><c5><a href="#24_1_refs">&amp;</a></c5><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#30">key</a></c26><c4>)</c4><c21><a href="#24_1_refs">&nbsp;</a></c21><c3>{</c3><c21><a href="#24_1_refs">
</a></c21><br/><ln>&nbsp;38</ln><a id="38">&nbsp;</a><a id="n10830"><a id="n10829">&nbsp;</a></a><c21><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c21><c20><a href="../../../libstd/option.rs.html#n104337">None</a></c20><c21><a href="#24_1_refs">&nbsp;</a></c21><c4>=&gt;</c4><c21><a href="#24_1_refs">&nbsp;</a></c21><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#26">bcx</a></c26><c3>,</c3><c21><a href="#24_1_refs">
</a></c21><br/><ln>&nbsp;39</ln><a id="39">&nbsp;</a><a id="n10839"><a id="n10835"><a id="n10840"><a id="n10836"><a id="n10837"><a id="n10833"><a id="n10838"><a id="n10832"><a id="n10831"><a id="n10834">&nbsp;</a></a></a></a></a></a></a></a></a></a><c21><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c21><c20><a href="../../../libstd/option.rs.html#n104341">Some</a></c20><c4>(</c4><c20><a href="../../../libstd/option.rs.html#n104341">&amp;</a></c20><c20><a href="#39_14_refs">root_info</a></c20><c4>)</c4><c21><a href="#24_1_refs">&nbsp;</a></c21><c4>=&gt;</c4><c21><a href="#24_1_refs">&nbsp;</a></c21><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#42">root</a></c26><c4>(</c4><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#25">datum</a></c26><c3>,</c3><c27><a href="#24_1_refs">&nbsp;</a></c27><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#26">bcx</a></c26><c3>,</c3><c27><a href="#24_1_refs">&nbsp;</a></c27><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#27">span</a></c26><c3>,</c3><c27><a href="#24_1_refs">&nbsp;</a></c27><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#30">key</a></c26><c3>,</c3><c27><a href="#24_1_refs">&nbsp;</a></c27><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#39">root_info</a></c26><c4>)</c4><c21><a href="#24_1_refs">
</a></c21><br/><ln>&nbsp;40</ln><a id="40">&nbsp;</a>&nbsp;<c21><a href="#24_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c21><c3>}</c3><c22><a href="#24_1_refs">
</a></c22><br/><ln>&nbsp;41</ln><a id="41">&nbsp;</a>&nbsp;<c3>}</c3><c0>
</c0><br/><ln>&nbsp;42</ln><a id="42">&nbsp;</a><a id="n10842">&nbsp;</a><c0>
</c0><br/><ln>&nbsp;43</ln><a id="43">&nbsp;</a><a id="n10847"><a id="n10849"><a id="n10875"><a id="n10845"><a id="n10848">&nbsp;</a></a></a></a></a><c30>fn</c30><c30><a href="#42_1_refs">&nbsp;root</a></c30><c5><a href="#42_1_refs">&lt;'a</a></c5><c5>,</c5><c5><a href="#42_1_refs">&nbsp;K:</a></c5><c5><a href="../../../librustc/middle/trans/datum.rs.html#193">KindOps</a></c5><c5><a href="#42_1_refs">&gt;</a></c5><c4>(</c4><c20><a href="#43_23_refs">datum</a></c20><c1><a href="#42_1_refs">:&nbsp;</a></c1><c8><a href="#42_1_refs">&amp;</a></c8><c8><a href="../../../librustc/middle/trans/datum.rs.html#40">Datum&lt;</a></c8><c8><a href="c=0 n=10874">K</a></c8><c8><a href="../../../librustc/middle/trans/datum.rs.html#40">&gt;</a></c8><c3>,</c3><c1><a href="#42_1_refs">
</a></c1><br/><ln>&nbsp;44</ln><a id="44">&nbsp;</a><a id="n10856"><a id="n10855"><a id="n10854">&nbsp;</a></a></a><c1><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#44_23_refs">bcx</a></c20><c1><a href="#42_1_refs">:&nbsp;</a></c1><c8><a href="#42_1_refs">&amp;'a&nbsp;</a></c8><c8><a href="../../../librustc/middle/trans/common.rs.html#401">Block&lt;'a&gt;</a></c8><c3>,</c3><c1><a href="#42_1_refs">
</a></c1><br/><ln>&nbsp;45</ln><a id="45">&nbsp;</a><a id="n10859"><a id="n10860">&nbsp;</a></a><c1><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#42_1_refs">_span</a></c20><c1><a href="#42_1_refs">:&nbsp;</a></c1><c8><a href="../../../libsyntax/codemap.rs.html#n10620">Span</a></c8><c3>,</c3><c1><a href="#42_1_refs">
</a></c1><br/><ln>&nbsp;46</ln><a id="46">&nbsp;</a><a id="n10863"><a id="n10864">&nbsp;</a></a><c1><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#46_23_refs">root_key</a></c20><c1><a href="#42_1_refs">:&nbsp;</a></c1><c8><a href="../../../librustc/middle/borrowck/mod.rs.html#208">root_map_key</a></c8><c3>,</c3><c1><a href="#42_1_refs">
</a></c1><br/><ln>&nbsp;47</ln><a id="47">&nbsp;</a><a id="n10873"><a id="n10867"><a id="n10872"><a id="n11026"><a id="n10868">&nbsp;</a></a></a></a></a><c1><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c1><c20><a href="#47_23_refs">root_info</a></c20><c1><a href="#42_1_refs">:&nbsp;</a></c1><c8><a href="../../../librustc/middle/borrowck/mod.rs.html#379">RootInfo</a></c8><c4>)</c4><c1><a href="#42_1_refs">&nbsp;</a></c1><c4>-&gt;</c4><c1><a href="#42_1_refs">&nbsp;</a></c1><c8><a href="#42_1_refs">&amp;'a&nbsp;</a></c8><c8><a href="../../../librustc/middle/trans/common.rs.html#401">Block&lt;'a&gt;</a></c8><c1><a href="#42_1_refs">&nbsp;</a></c1><c3>{</c3><c22><a href="#42_1_refs">
</a></c22><br/><ln>&nbsp;48</ln><a id="48">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//!&nbsp;In&nbsp;some&nbsp;cases,&nbsp;borrowck&nbsp;will&nbsp;decide&nbsp;that&nbsp;an&nbsp;@T&nbsp;value&nbsp;must&nbsp;be
</c40><br/><ln>&nbsp;49</ln><a id="49">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//!&nbsp;rooted&nbsp;for&nbsp;the&nbsp;program&nbsp;to&nbsp;be&nbsp;safe.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;we&nbsp;will&nbsp;call
</c40><br/><ln>&nbsp;50</ln><a id="50">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//!&nbsp;this&nbsp;function,&nbsp;which&nbsp;will&nbsp;stash&nbsp;a&nbsp;copy&nbsp;away&nbsp;until&nbsp;we&nbsp;exit&nbsp;the
</c40><br/><ln>&nbsp;51</ln><a id="51">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//!&nbsp;scope&nbsp;`scope_id`.
</c40><br/><ln>&nbsp;52</ln><a id="52">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">
</a></c22><br/><ln>&nbsp;53</ln><a id="53">&nbsp;</a><a id="n10963"><a id="n10938"><a id="n11017"><a id="n10964"><a id="n10969"><a id="n10940"><a id="n10976"><a id="n10960"><a id="n10930"><a id="n10948"><a id="n10997"><a id="n10999"><a id="n10950"><a id="n10929"><a id="n10931"><a id="n10933"><a id="n11002"><a id="n10967"><a id="n10955"><a id="n10953"><a id="n10928"><a id="n10978"><a id="n10993"><a id="n10998"><a id="n10923"><a id="n10965"><a id="n10958"><a id="n11003"><a id="n10941"><a id="n10934"><a id="n10947"><a id="n10926"><a id="n10974"><a id="n10991"><a id="n10961"><a id="n10946"><a id="n10951"><a id="n10944"><a id="n10945"><a id="n11001"><a id="n10954"><a id="n10922"><a id="n10937"><a id="n11000"><a id="n11020"><a id="n10952"><a id="n10943"><a id="n10994"><a id="n10939"><a id="n10966"><a id="n10970"><a id="n10962"><a id="n10973"><a id="n10972"><a id="n10949"><a id="n10932"><a id="n10957"><a id="n10968"><a id="n10995"><a id="n10992"><a id="n10956"><a id="n10977"><a id="n10936"><a id="n10935"><a id="n10927"><a id="n10942"><a id="n10971"><a id="n10918"><a id="n10996"><a id="n11004"><a id="n10959"><a id="n10975">&nbsp;</a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a><c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;debug!</a></c22><c4>(</c4><c13><a href="#53_11_refs">"write_guard::root</a></c13><c4>(</c4><c13><a href="#53_11_refs">root_key=</a></c13><c3>{</c3><c13><a href="#53_11_refs">:?</a></c13><c3>},</c3><c13><a href="#53_11_refs">&nbsp;root_info=</a></c13><c3>{</c3><c13><a href="#53_11_refs">:?</a></c13><c3>},</c3><c13><a href="#53_11_refs">&nbsp;datum=</a></c13><c3>{</c3><c13><a href="#53_11_refs">:?</a></c13><c3>}</c3><c4>)</c4><c13><a href="#53_11_refs">"</a></c13><c3>,</c3><c22><a href="#42_1_refs">
</a></c22><br/><ln>&nbsp;54</ln><a id="54">&nbsp;</a><a id="n10916"><a id="n10919"><a id="n10988"><a id="n10989"><a id="n10990"><a id="n10920"><a id="n10915"><a id="n10979"><a id="n10914"><a id="n10980"><a id="n10912"><a id="n10985"><a id="n10913"><a id="n10987"><a id="n10917"><a id="n10986"><a id="n10984"><a id="n10981"><a id="n10910"><a id="n10921"><a id="n10911"><a id="n10982"><a id="n10909"><a id="n10983">&nbsp;</a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a><c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#46">root_key</a></c26><c3>,</c3><c22><a href="#42_1_refs">&nbsp;</a></c22><c26><a href="../../../libstd/fmt/mod.rs.html#n171474">root_info</a></c26><c3>,</c3><c22><a href="#42_1_refs">&nbsp;</a></c22><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#43">datum</a></c26><c20><a href="#54_32_refs">.to_str</a></c20><c4>(</c4><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#44">bcx</a></c26><c10><a href="../../../librustc/middle/trans/common.rs.html#441">.ccx</a></c10><c4>()))</c4><c3>;</c3><c22><a href="#42_1_refs">
</a></c22><br/><ln>&nbsp;55</ln><a id="55">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">
</a></c22><br/><ln>&nbsp;56</ln><a id="56">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//&nbsp;Root&nbsp;the&nbsp;datum.&nbsp;Note&nbsp;that&nbsp;we&nbsp;must&nbsp;zero&nbsp;this&nbsp;value,
</c40><br/><ln>&nbsp;57</ln><a id="57">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//&nbsp;because&nbsp;sometimes&nbsp;we&nbsp;root&nbsp;on&nbsp;one&nbsp;path&nbsp;but&nbsp;not&nbsp;another.
</c40><br/><ln>&nbsp;58</ln><a id="58">&nbsp;</a>&nbsp;<c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c40>//&nbsp;See&nbsp;e.g.&nbsp;#4904.
</c40><br/><ln>&nbsp;59</ln><a id="59">&nbsp;</a><a id="n11055"><a id="n11027"><a id="n11056">&nbsp;</a></a></a><c22><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;</a></c22><c26><a href="../../../librustc/middle/trans/datum.rs.html#115">lvalue_scratch_datum</a></c26><c4>(</c4><c27><a href="#42_1_refs">
</a></c27><br/><ln>&nbsp;60</ln><a id="60">&nbsp;</a><a id="n11029"><a id="n11030"><a id="n11032"><a id="n11031"><a id="n11028">&nbsp;</a></a></a></a></a><c27><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c27><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#44">bcx</a></c26><c3>,</c3><c27><a href="#42_1_refs">&nbsp;</a></c27><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#43">datum</a></c26><c24><a href="../../../librustc/middle/trans/datum.rs.html#47">.ty</a></c24><c3>,</c3><c27><a href="#42_1_refs">&nbsp;</a></c27><c12><a href="#42_1_refs">"__write_guard"</a></c12><c3>,</c3><c27><a href="#42_1_refs">&nbsp;</a></c27><c12><a href="#42_1_refs">true</a></c12><c3>,</c3><c27><a href="#42_1_refs">
</a></c27><br/><ln>&nbsp;61</ln><a id="61">&nbsp;</a><a id="n11035"><a id="n11037"><a id="n11036"><a id="n11034"><a id="n11033">&nbsp;</a></a></a></a></a><c27><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c27><c26><a href="../../../librustc/middle/trans/cleanup.rs.html#76">cleanup::AstScope</a></c26><c4>(</c4><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#47">root_info</a></c26><c24><a href="../../../librustc/middle/borrowck/mod.rs.html#381">.scope</a></c24><c4>)</c4><c3>,</c3><c27><a href="#42_1_refs">&nbsp;</a></c27><c4>()</c4><c3>,</c3><c27><a href="#42_1_refs">
</a></c27><br/><ln>&nbsp;62</ln><a id="62">&nbsp;</a><a id="n11052"><a id="n11046"><a id="n11048"><a id="n11051"><a id="n11049"><a id="n11044"><a id="n11054"><a id="n11043"><a id="n11047"><a id="n11041"><a id="n11050"><a id="n11053"><a id="n11039"><a id="n11040">&nbsp;</a></a></a></a></a></a></a></a></a></a></a></a></a></a><c27><a href="#42_1_refs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></c27><c1><a href="#42_1_refs">|</a></c1><c4>()</c4><c3>,</c3><c1><a href="#42_1_refs">&nbsp;</a></c1><c20><a href="#62_13_refs">bcx</a></c20><c3>,</c3><c1><a href="#42_1_refs">&nbsp;</a></c1><c20><a href="#62_18_refs">llval</a></c20><c8><a href="#42_1_refs">|</a></c8><c1><a href="#42_1_refs">&nbsp;</a></c1><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#43">datum</a></c26><c10><a href="../../../librustc/middle/trans/datum.rs.html#617">.shallow_copy_and_take</a></c10><c4>(</c4><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#62">bcx</a></c26><c3>,</c3><c10><a href="../../../librustc/middle/trans/datum.rs.html#617">&nbsp;</a></c10><c26><a href="../../../librustc/middle/trans/write_guard.rs.html#62">llval</a></c26><c4>))</c4><c24><a href="../../../librustc/middle/trans/datum.rs.html#54">.bcx</a></c24><c22><a href="#42_1_refs">
</a></c22><br/><ln>&nbsp;63</ln><a id="63">&nbsp;</a>&nbsp;<c3>}</c3><c0>
</c0><br/><div class="refblock"><br/><a id="42_1_refs"><a href="#42"><c40>librustc/middle/trans/write_guard.rs:42:1-42:1&nbsp;-fn-&nbsp;definition:<br/></c40><pr>
<br/>fn&nbsp;root&lt;'a,&nbsp;K:KindOps&gt;(datum:&nbsp;&amp;Datum&lt;K&gt;,
<br/></pr></a></a><c40>references:-</c40><br/><a href="../../../librustc/middle/trans/write_guard.rs.html#39"><c40>39:&nbsp;</c40>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Some(&amp;root_info)&nbsp;=&gt;&nbsp;root(datum,&nbsp;bcx,&nbsp;span,&nbsp;key,&nbsp;root_info)
<br/></a><br/><br/><a id="24_1_refs"><a href="#24"><c40>librustc/middle/trans/write_guard.rs:24:1-24:1&nbsp;-fn-&nbsp;definition:<br/></c40><pr>
<br/>pub&nbsp;fn&nbsp;root_and_write_guard&lt;'a,&nbsp;K:KindOps&gt;(datum:&nbsp;&amp;Datum&lt;K&gt;,
<br/></pr></a></a><c40>references:-</c40><br/><a href="../../../librustc/middle/trans/expr.rs.html"><c40>librustc/middle/trans/expr.rs:<br/></c40></a><a href="../../../librustc/middle/trans/expr.rs.html#1693"><c40>1693:&nbsp;</c40>&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;bcx&nbsp;=&nbsp;write_guard::root_and_write_guard(&amp;datum,&nbsp;bcx,&nbsp;expr.span,
<br/></a><a href="../../../librustc/middle/trans/datum.rs.html"><c40>librustc/middle/trans/datum.rs:<br/></c40></a><a href="../../../librustc/middle/trans/datum.rs.html#655"><c40>655:&nbsp;</c40>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_guard::root_and_write_guard(self,&nbsp;bcx,&nbsp;span,&nbsp;expr_id,&nbsp;derefs)
<br/></a><br/></div></maintext></div></body>